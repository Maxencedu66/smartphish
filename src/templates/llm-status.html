{% extends "index.html" %}

{% block title %}Statut du LLM - SmartPhish{% endblock %}

{% block content %}
<h2>ü§ñ Statut du LLM</h2>
<!-- <p>Contenu de la section statut du LLM.</p> -->

<br>

<h4>Mod√®les t√©l√©charg√©s</h4>

<table class="table table-striped" style="max-width: 1000px;">
    <thead>
        <tr>
            <th></th>
            <th>Nom</th>
            <th>Taille (MB)</th>
            <th>Famille</th>
            <th>Param√®tres</th>
            <th>Derni√®re modification</th>
        </tr>
    </thead>
    <tbody id="model-status">
        {% for model in status %}
        <tr>
            <td><span class="badge bg-{{ " success" if model.expires_at else "danger" }}">{{"En m√©moire" if
                    model.expires_at else "Non charg√©" }}</span></td>
            <td>{{ model.name }}</td>
            <td>{{ model.size_mb }}</td>
            <td>{{ model.family }}</td>
            <td>{{ model.parameter_size }}</td>
            <td>{{ model.modified_at }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p style="font-size: 16; color: darkgrey;" id="refresh-timer">Prochaine mise √† jour dans <span id="countdown">5</span> secondes.</p>

<script>
    function fetchStatus() {
        fetch('/llm-status-get')
            .then(response => response.json())
            .then(data => {
                const tbody = document.getElementById('model-status');
                tbody.innerHTML = '';
                data.forEach(model => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class="badge bg-${model.expires_at ? 'success' : 'danger'}">${model.expires_at ? 'En m√©moire' : 'Non charg√©'}</span></td>
                        <td>${model.name}</td>
                        <td>${model.size_mb}</td>
                        <td>${model.family}</td>
                        <td>${model.parameter_size}</td>
                        <td>${model.modified_at}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching status:', error));
    }

    function startCountdown() {
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');
        const interval = setInterval(() => {
            countdown--;
            countdownElement.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(interval);
                countdown = 5;
                fetchStatus();
                startCountdown();
            }
        }, 1000);
    }

    fetchStatus(); // Initial fetch
    startCountdown();
</script>

{% endblock %}