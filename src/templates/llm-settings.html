{% extends "index.html" %}

{% block title %}Paramètres du LLM - SmartPhish{% endblock %}

{% block content %}
<h2>⚙️ Paramètres du LLM</h2>
<!-- <p>Contenu de la section paramètres du LLM.</p> -->

<h5 style="margin-top: 20px; margin-bottom: 13px;">Modèle conversationnel</h5>

{% for model in models %}
<div class="form-check mt-2">
    <input class="form-check-input" type="radio" name="exampleRadios" id="{{ model.name }}" value="{{ model.name }}"  {{ 'checked' if model.used else '' }} onclick="setModel()">
    <label class="form-check-label" for="{{ model.name }}">
        {{ model.description }}
    </label>
</div>
{% endfor %}

<script>
    function setModel() {
        let new_model = document.querySelector('input[name="exampleRadios"]:checked').value;
        // console.log(new_model);

        fetch("/set-model", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ model: new_model })
        })
            .then(response => response.json())
            .then(data => {
                if (data.result === "OK") {
                    if (data.need_pull) {
                        Swal.fire({
                            icon: "info",
                            title: "Changement en cours...",
                            text: "Le modèle est en cours de téléchargement. Cette opération peut prendre quelques minutes. Le modèle sera visible sur la page de statut des modèles lorsqu'il sera téléchargé. Vous pouvez continuer à utiliser l'application pendant ce temps.",
                            width: '50em',
                            // timer: 5000,
                            showConfirmButton: true,
                            backdrop: false,
                            position: "center"
                        });
                    } else {
                        Swal.fire({
                            icon: "success",
                            title: "Changement effectué",
                            text: " ",
                            timer: 1000,
                            showConfirmButton: false,
                            backdrop: false,
                            position: "center"
                        });
                    }
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Échec du changement",
                        text: "Erreur lors du changement de modèle. Veuillez réessayer.",
                        backdrop: false,
                        position: "center"
                    });
                }
            })
            .catch(error => {
                console.error("Erreur réseau :", error);
                Swal.fire({
                    icon: "error",
                    title: "Erreur",
                    text: "Une erreur est survenue. Veuillez réessayer.",
                    backdrop: false,
                    position: "center"
                });
            });
    }

</script>

{% endblock %}