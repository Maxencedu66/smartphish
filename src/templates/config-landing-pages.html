{% extends "index.html" %}
{% block title %}Configuration Landing Pages - SmartPhish{% endblock %}

{% block content %}
<h2>‚öôÔ∏è Configuration</h2>

<ul class="nav nav-tabs">
    <li class="nav-item"><a class="nav-link" href="{{ url_for('frontend.config_groups') }}">Groupes</a></li>
    <li class="nav-item"><a class="nav-link" href="{{ url_for('frontend.config_emails') }}">Mod√®les d'e-mails</a></li>
    <li class="nav-item"><a class="nav-link active" href="{{ url_for('frontend.config_landing_pages') }}">Page de destination</a></li>
    <li class="nav-item"><a class="nav-link" href="{{ url_for('frontend.config_smtp') }}">Profil d'envoi</a></li>
</ul>

<h3 style="margin-top: 11px;">üìÑ Gestion des Pages de destination</h3>

<!-- Bouton pour ouvrir le modal de cr√©ation -->
<div class="mb-3">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#newLandingPageModal">‚ûï Nouvelle Page de destination</button>
</div>

<!-- Table des landing pages -->
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-dark">
            <tr><th>Nom</th><th class="text-end"></th></tr>
        </thead>
        <tbody id="landingPageTableBody">
            {% for page in landing_pages %}
            <tr data-id="{{ page.id }}">
                <td>{{ page.name }}</td>
                <td class="text-end">
                    <button class="btn btn-primary btn-sm edit-landing-page" data-id="{{ page.id }}" data-bs-toggle="modal" data-bs-target="#editLandingPageModal">Modifier</button>
                    <button class="btn btn-danger btn-sm delete-landing-page" data-id="{{ page.id }}">Supprimer</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ========== MODAL: CR√âER UNE NOUVELLE LANDING PAGE ========== -->
<div class="modal fade" id="newLandingPageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Cr√©er une Page de Destination</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Nom de la landing page -->
                <label for="newLandingPageName" class="form-label"><strong>Nom :</strong></label>
                <input type="text" id="newLandingPageName" placeholder="Saisissez un nom pour cette page..." class="form-control mb-2" required>

                <!-- Section Importer un site -->
                <div class="border p-2 mb-3">
                    <h6 class="mb-2">Importer un site</h6>
                    <label for="importSiteURL" class="form-label"><strong>URL du site :</strong></label>
                    <input type="text" id="importSiteURL" class="form-control" placeholder="http://example.com">
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="includeResources">
                        <label class="form-check-label" for="includeResources">
                            Inclure les ressources (ajouter un tag &lt;base&gt;)
                        </label>
                    </div>
                    <button class="btn btn-info btn-sm mt-2" type="button" onclick="importSite()">Importer</button>
                </div>

                <!-- Code HTML de la landing page -->
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <label for="newLandingPageHTML" class="form-label"><strong>Aper√ßu / Code source</strong></label>
                    <!-- Le bouton bascule l'affichage entre le textarea et l'iframe de preview -->
                    <div class="form-check form-switch">
                        <label class="form-check-label" for="toggleViewSwitch">
                            <input class="form-check-input" type="checkbox" id="toggleViewSwitch" onchange="togglePreview('newLandingPageHTML', 'previewNewPageFrame')">
                            <span id="toggleLabel">Code</span> / <span>Vue</span>
                        </label>
                    </div>
                </div>
                <textarea id="newLandingPageHTML" placeholder="Tapez ici le contenu du message √† envoyer..." class="form-control" rows="5" required></textarea>
                <!-- Utilisation d'un iframe pour isoler le rendu -->
                <iframe id="previewNewPageFrame" style="display:none; width:100%; height:300px; border:1px solid #ccc;"></iframe>

                <!-- Options suppl√©mentaires -->
                <label class="form-label mt-2"><strong>Capture des donn√©es :</strong></label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="newCaptureCredentials">
                    <label class="form-check-label" for="newCaptureCredentials">
                        Activer la capture des donn√©es
                    </label>
                </div>

                <label class="form-label mt-2"><strong>Capture des mots de passe :</strong></label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="newCapturePasswords" disabled>
                    <label class="form-check-label" for="newCapturePasswords">
                        Capturer √©galement les mots de passe
                    </label>
                </div>

                <label for="newRedirectUrl" class="form-label mt-2"><strong>URL de redirection :</strong></label>
                <input type="text" id="newRedirectUrl" class="form-control" placeholder="http://example.com">
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="submitNewLandingPage()">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

<!-- Le modal de modification reste inchang√© -->
<!-- ========== MODAL: MODIFIER UNE LANDING PAGE ========== -->
<div class="modal fade" id="editLandingPageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Modifier une Page de destination</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editLandingPageId">
                <label for="editLandingPageName" class="form-label"><strong>Nom :</strong></label>
                <input type="text" id="editLandingPageName" placeholder="Saisissez un nom pour cette page..." class="form-control mb-2" required>
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <label for="editLandingPageHTML" class="form-label"><strong>Aper√ßu / Code source</strong></label>
                    <div class="form-check form-switch">
                        <label class="form-check-label" for="toggleViewSwitch">
                            <input class="form-check-input" type="checkbox" id="toggleViewSwitch" onchange="togglePreview('editLandingPageHTML', 'previewEditPageFrame')">
                            <span id="toggleLabel">Code</span> / <span>Vue</span>
                        </label>
                    </div>
                </div>
                <textarea id="editLandingPageHTML" placeholder="Tapez ici le contenu du message √† envoyer..." class="form-control" rows="5" required></textarea>
                <iframe id="previewEditPageFrame" style="display:none; width:100%; height:300px; border:1px solid #ccc;"></iframe>
                
                <!-- Options suppl√©mentaires -->
                <label class="form-label mt-2"><strong>Capture des donn√©es :</strong></label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="editCaptureCredentials" checked>
                    <label class="form-check-label" for="editCaptureCredentials">
                        Activer la capture des donn√©es
                    </label>
                </div>
                <label class="form-label mt-2"><strong>Capture des mots de passe :</strong></label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="editCapturePasswords">
                    <label class="form-check-label" for="editCapturePasswords">
                        Capturer √©galement les mots de passe
                    </label>
                </div>
                <label for="editRedirectUrl" class="form-label mt-2"><strong>URL de redirection :</strong></label>
                <input type="text" id="editRedirectUrl" class="form-control" placeholder="http://example.com">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="submitEditedLandingPage()">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

    
<script src="{{ url_for('static', filename='js/config-landing-pages.js') }}" defer></script>

{% endblock %}
