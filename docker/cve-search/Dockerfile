# Use an official Python runtime as a parent image
FROM mongo:8.0.6-noble

# Install necessary dependencies
RUN apt-get update
RUN apt-get install -y git python3 python3-pip gnupg curl python3-venv

# Clone the cve-search repository
RUN git clone https://github.com/cve-search/cve-search.git /cve-search

# Set the working directory
WORKDIR /cve-search

# Create a virtual environment
RUN python3 -m venv venv
ENV PATH="/cve-search/venv/bin:$PATH"

# Install Python dependencies
RUN pip3 install --upgrade pip
RUN pip3 install -r requirements.txt

COPY configuration.ini /cve-search/etc/configuration.ini

CMD [ "sh", "-c", "mongod & sleep 5 && python3 web/index.py" ]